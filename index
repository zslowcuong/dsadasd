<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ dự đoán Tài Xỉu cao cấp</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4cb963;
            --danger-color: #e63946;
            --warning-color: #ff9f1c;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
        }
        
        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section, .results-section, .advanced-section {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        h3 {
            color: var(--secondary-color);
            margin: 15px 0 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .tai-button {
            background-color: var(--accent-color);
            color: white;
            flex: 1;
        }
        
        .tai-button:hover {
            background-color: #3da050;
            transform: translateY(-2px);
        }
        
        .xiu-button {
            background-color: var(--danger-color);
            color: white;
            flex: 1;
        }
        
        .xiu-button:hover {
            background-color: #c53030;
            transform: translateY(-2px);
        }
        
        .action-button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .undo-button {
            background-color: var(--warning-color);
            color: white;
        }
        
        .undo-button:hover {
            background-color: #e68a00;
        }
        
        .clear-button {
            background-color: var(--danger-color);
            color: white;
        }
        
        .clear-button:hover {
            background-color: #c53030;
        }
        
        .result-box {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .prediction {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .tai {
            background-color: rgba(76, 185, 99, 0.2);
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }
        
        .xiu {
            background-color: rgba(230, 57, 70, 0.2);
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
        }
        
        .probability-bar {
            height: 30px;
            background-color: #e9ecef;
            border-radius: 15px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }
        
        .probability-fill {
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s ease-in-out;
        }
        
        .tai-fill {
            background-color: var(--accent-color);
        }
        
        .xiu-fill {
            background-color: var(--danger-color);
        }
        
        .probability-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .history-list {
            list-style-type: none;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-tai {
            background-color: rgba(76, 185, 99, 0.1);
            border-left: 4px solid var(--accent-color);
        }
        
        .history-xiu {
            background-color: rgba(230, 57, 70, 0.1);
            border-left: 4px solid var(--danger-color);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .tai-stat {
            color: var(--accent-color);
        }
        
        .xiu-stat {
            color: var(--danger-color);
        }
        
        .disclaimer {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #856404;
        }
        
        .algorithm-info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .algorithm-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .current-history {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .history-display {
            font-family: monospace;
            font-size: 1.2rem;
            letter-spacing: 3px;
            text-align: center;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .history-item-display {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            margin: 2px;
            border-radius: 50%;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tai-display {
            background-color: rgba(76, 185, 99, 0.2);
            color: var(--accent-color);
        }
        
        .xiu-display {
            background-color: rgba(230, 57, 70, 0.2);
            color: var(--danger-color);
        }
        
        .analysis-info {
            background-color: #e2f7e2;
            border: 1px solid #b8e6b8;
            border-radius: 8px;
            padding: 10px 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #2d5a2d;
        }
        
        .advanced-section {
            grid-column: 1 / -1;
        }
        
        .algorithms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .algorithm-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-color);
        }
        
        .algorithm-card h4 {
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .algorithm-card p {
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .algorithm-accuracy {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .confidence-indicator {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .confidence-bar {
            flex: 1;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-right: 10px;
        }
        
        .confidence-fill {
            height: 100%;
            background-color: var(--accent-color);
            border-radius: 4px;
            transition: width 0.5s;
        }
        
        .confidence-text {
            font-size: 0.9rem;
            font-weight: bold;
            min-width: 50px;
        }
        
        .trend-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .trend-up {
            background-color: rgba(76, 185, 99, 0.2);
            color: var(--accent-color);
        }
        
        .trend-down {
            background-color: rgba(230, 57, 70, 0.2);
            color: var(--danger-color);
        }
        
        .trend-neutral {
            background-color: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }
        
        .pattern-visualization {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
            text-align: center;
        }
        
        .hot-streak {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 185, 99, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(76, 185, 99, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 185, 99, 0); }
        }
        
        .prediction-confidence {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }
        
        .confidence-level {
            font-size: 1rem;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 20px;
            margin-left: 10px;
        }
        
        .high-confidence {
            background-color: rgba(76, 185, 99, 0.2);
            color: var(--accent-color);
        }
        
        .medium-confidence {
            background-color: rgba(255, 159, 28, 0.2);
            color: var(--warning-color);
        }
        
        .low-confidence {
            background-color: rgba(230, 57, 70, 0.2);
            color: var(--danger-color);
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .accuracy-high {
            color: var(--accent-color);
        }
        
        .accuracy-medium {
            color: var(--warning-color);
        }
        
        .accuracy-low {
            color: var(--danger-color);
        }
        
        .button-active {
            transform: scale(0.95);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Công cụ dự đoán Tài Xỉu cao cấp</h1>
            <p class="subtitle">Sử dụng thuật toán AI và phân tích thống kê tiên tiến để tối ưu hóa dự đoán</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <h2>Nhập dữ liệu</h2>
                
                <div class="form-group">
                    <label>Thêm kết quả:</label>
                    <div class="button-group">
                        <button id="addTai" class="tai-button">TÀI</button>
                        <button id="addXiu" class="xiu-button">XỈU</button>
                    </div>
                    <div class="action-button-group">
                        <button id="undoButton" class="undo-button">UNDO (Hoàn tác)</button>
                        <button id="clearHistory" class="clear-button">XÓA LỊCH SỬ</button>
                    </div>
                </div>
                
                <div class="current-history">
                    <h3>Lịch sử hiện tại:</h3>
                    <div id="currentHistoryDisplay" class="history-display">Chưa có dữ liệu</div>
                </div>
                
                <div class="form-group">
                    <label for="algorithm">Thuật toán chính:</label>
                    <select id="algorithm">
                        <option value="ensemble">Tổng hợp đa mô hình (Ensemble)</option>
                        <option value="markov">Markov ẩn (HMM)</option>
                        <option value="lstm">Mạng thần kinh LSTM</option>
                        <option value="arima">ARIMA - Phân tích chuỗi thời gian</option>
                        <option value="pattern">Nhận dạng mẫu hình nâng cao</option>
                    </select>
                </div>
                
                <div class="analysis-info">
                    <strong>Thông tin phân tích:</strong> Hệ thống tự động phân tích <span id="analysisCount">0</span> phiên gần nhất
                </div>
                
                <div class="disclaimer">
                    <strong>Lưu ý:</strong> Đây chỉ là công cụ hỗ trợ phân tích dựa trên xác suất thống kê, không đảm bảo kết quả chính xác 100%. Hãy sử dụng có trách nhiệm.
                </div>
            </div>
            
            <div class="results-section">
                <h2>Kết quả dự đoán</h2>
                
                <div class="result-box">
                    <h3>Dự đoán phiên tiếp theo</h3>
                    <div id="predictionResult" class="prediction">
                        Nhập dữ liệu để xem dự đoán
                    </div>
                    
                    <div class="prediction-confidence">
                        Độ tin cậy: 
                        <span id="confidenceLevel" class="confidence-level medium-confidence">Trung bình</span>
                    </div>
                    
                    <h3>Xác suất</h3>
                    <div class="probability-bar">
                        <div id="taiProbability" class="probability-fill tai-fill" style="width: 50%"></div>
                        <div class="probability-text">Tài: <span id="taiPercent">50%</span> | Xỉu: <span id="xiuPercent">50%</span></div>
                    </div>
                    
                    <div class="confidence-indicator">
                        <div class="confidence-bar">
                            <div id="confidenceFill" class="confidence-fill" style="width: 50%"></div>
                        </div>
                        <div class="confidence-text" id="confidenceValue">50%</div>
                    </div>
                </div>
                
                <div class="result-box">
                    <h3>Thống kê lịch sử</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div>Tổng số phiên</div>
                            <div id="totalGames" class="stat-value">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Tài</div>
                            <div id="taiCount" class="stat-value tai-stat">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Xỉu</div>
                            <div id="xiuCount" class="stat-value xiu-stat">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Tỷ lệ Tài</div>
                            <div id="taiRatio" class="stat-value">0%</div>
                        </div>
                        <div class="stat-item">
                            <div>Chuỗi Tài dài nhất</div>
                            <div id="maxTaiStreak" class="stat-value">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Chuỗi Xỉu dài nhất</div>
                            <div id="maxXiuStreak" class="stat-value">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Xu hướng hiện tại</div>
                            <div id="currentTrend" class="stat-value">-</div>
                        </div>
                        <div class="stat-item">
                            <div>Độ biến động</div>
                            <div id="volatility" class="stat-value">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-box">
                    <h3>Lịch sử gần đây</h3>
                    <ul id="historyList" class="history-list">
                        <li class="history-item">Chưa có dữ liệu</li>
                    </ul>
                </div>
            </div>
            
            <div class="advanced-section">
                <h2>Phân tích nâng cao</h2>
                
                <div class="performance-metrics">
                    <div class="metric-card">
                        <div>Độ chính xác tổng thể</div>
                        <div id="overallAccuracy" class="metric-value accuracy-high">-</div>
                    </div>
                    <div class="metric-card">
                        <div>Độ chính xác gần đây</div>
                        <div id="recentAccuracy" class="metric-value accuracy-medium">-</div>
                    </div>
                    <div class="metric-card">
                        <div>Hiệu suất dự đoán Tài</div>
                        <div id="taiAccuracy" class="metric-value accuracy-high">-</div>
                    </div>
                    <div class="metric-card">
                        <div>Hiệu suất dự đoán Xỉu</div>
                        <div id="xiuAccuracy" class="metric-value accuracy-medium">-</div>
                    </div>
                </div>
                
                <div class="algorithms-grid">
                    <div class="algorithm-card">
                        <h4>Mô hình Markov ẩn</h4>
                        <p>Phân tích trạng thái ẩn và xác suất chuyển đổi giữa các trạng thái.</p>
                        <div class="confidence-indicator">
                            <div class="confidence-bar">
                                <div id="markovConfidence" class="confidence-fill" style="width: 0%"></div>
                            </div>
                            <div class="confidence-text" id="markovValue">0%</div>
                        </div>
                    </div>
                    
                    <div class="algorithm-card">
                        <h4>Mạng thần kinh LSTM</h4>
                        <p>Học sâu để nhận diện mẫu hình phức tạp trong chuỗi thời gian.</p>
                        <div class="confidence-indicator">
                            <div class="confidence-bar">
                                <div id="lstmConfidence" class="confidence-fill" style="width: 0%"></div>
                            </div>
                            <div class="confidence-text" id="lstmValue">0%</div>
                        </div>
                    </div>
                    
                    <div class="algorithm-card">
                        <h4>Phân tích chuỗi thời gian ARIMA</h4>
                        <p>Phân tích thành phần xu hướng, mùa vụ và nhiễu trong dữ liệu.</p>
                        <div class="confidence-indicator">
                            <div class="confidence-bar">
                                <div id="arimaConfidence" class="confidence-fill" style="width: 0%"></div>
                            </div>
                            <div class="confidence-text" id="arimaValue">0%</div>
                        </div>
                    </div>
                    
                    <div class="algorithm-card">
                        <h4>Nhận dạng mẫu hình</h4>
                        <p>Phát hiện các mẫu lặp lại và chu kỳ trong lịch sử kết quả.</p>
                        <div class="confidence-indicator">
                            <div class="confidence-bar">
                                <div id="patternConfidence" class="confidence-fill" style="width: 0%"></div>
                            </div>
                            <div class="confidence-text" id="patternValue">0%</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-box">
                    <h3>Phân tích xu hướng & Mẫu hình</h3>
                    <div id="patternAnalysis" class="pattern-visualization">
                        Chưa đủ dữ liệu để phân tích mẫu hình
                    </div>
                </div>
                
                <div class="algorithm-info">
                    <div class="algorithm-title">Giải thích thuật toán tổng hợp</div>
                    <div id="algorithmExplanation">
                        Hệ thống sử dụng kết hợp nhiều thuật toán tiên tiến (Ensemble Learning) để đưa ra dự đoán tối ưu. Mỗi thuật toán được đánh giá dựa trên độ chính xác lịch sử và được gán trọng số phù hợp trong quá trình tổng hợp kết quả.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Khai báo tất cả các biến cần thiết
            const addTaiBtn = document.getElementById('addTai');
            const addXiuBtn = document.getElementById('addXiu');
            const clearHistoryBtn = document.getElementById('clearHistory');
            const undoButton = document.getElementById('undoButton');
            const algorithmSelect = document.getElementById('algorithm');
            const predictionResult = document.getElementById('predictionResult');
            const taiProbability = document.getElementById('taiProbability');
            const taiPercent = document.getElementById('taiPercent');
            const xiuPercent = document.getElementById('xiuPercent');
            const totalGames = document.getElementById('totalGames');
            const taiCount = document.getElementById('taiCount');
            const xiuCount = document.getElementById('xiuCount');
            const taiRatio = document.getElementById('taiRatio');
            const historyList = document.getElementById('historyList');
            const algorithmExplanation = document.getElementById('algorithmExplanation');
            const currentHistoryDisplay = document.getElementById('currentHistoryDisplay');
            const analysisCount = document.getElementById('analysisCount');
            const confidenceFill = document.getElementById('confidenceFill');
            const confidenceValue = document.getElementById('confidenceValue');
            const confidenceLevel = document.getElementById('confidenceLevel');
            const maxTaiStreak = document.getElementById('maxTaiStreak');
            const maxXiuStreak = document.getElementById('maxXiuStreak');
            const currentTrend = document.getElementById('currentTrend');
            const volatility = document.getElementById('volatility');
            const patternAnalysis = document.getElementById('patternAnalysis');
            
            // Các phần tử cho thuật toán nâng cao
            const markovConfidence = document.getElementById('markovConfidence');
            const markovValue = document.getElementById('markovValue');
            const lstmConfidence = document.getElementById('lstmConfidence');
            const lstmValue = document.getElementById('lstmValue');
            const arimaConfidence = document.getElementById('arimaConfidence');
            const arimaValue = document.getElementById('arimaValue');
            const patternConfidence = document.getElementById('patternConfidence');
            const patternValue = document.getElementById('patternValue');
            
            // Các phần tử cho hiệu suất
            const overallAccuracy = document.getElementById('overallAccuracy');
            const recentAccuracy = document.getElementById('recentAccuracy');
            const taiAccuracy = document.getElementById('taiAccuracy');
            const xiuAccuracy = document.getElementById('xiuAccuracy');
            
            // Khởi tạo dữ liệu
            let gameHistory = [];
            let predictionHistory = [];
            let algorithmWeights = {
                markov: 0.25,
                lstm: 0.30,
                arima: 0.25,
                pattern: 0.20
            };
            
            // Cập nhật giải thích thuật toán
            algorithmSelect.addEventListener('change', updateAlgorithmExplanation);
            
            function updateAlgorithmExplanation() {
                const algorithm = algorithmSelect.value;
                let explanation = '';
                
                switch(algorithm) {
                    case 'ensemble':
                        explanation = 'Hệ thống sử dụng kết hợp nhiều thuật toán tiên tiến (Ensemble Learning) để đưa ra dự đoán tối ưu. Mỗi thuật toán được đánh giá dựa trên độ chính xác lịch sử và được gán trọng số phù hợp trong quá trình tổng hợp kết quả.';
                        break;
                    case 'markov':
                        explanation = 'Mô hình Markov ẩn (HMM) phân tích các trạng thái ẩn và xác suất chuyển đổi giữa chúng. Phương pháp này giả định rằng hệ thống có các trạng thái không quan sát được ảnh hưởng đến kết quả quan sát được.';
                        break;
                    case 'lstm':
                        explanation = 'Mạng thần kinh LSTM (Long Short-Term Memory) là một loại RNN có khả năng học các phụ thuộc dài hạn trong chuỗi thời gian. Nó đặc biệt hiệu quả trong việc nhận dạng mẫu hình phức tạp và xu hướng dài hạn.';
                        break;
                    case 'arima':
                        explanation = 'ARIMA (AutoRegressive Integrated Moving Average) là mô hình thống kê mạnh mẽ để phân tích và dự báo chuỗi thời gian. Nó phân tích thành phần xu hướng, mùa vụ và nhiễu trong dữ liệu.';
                        break;
                    case 'pattern':
                        explanation = 'Thuật toán nhận dạng mẫu hình nâng cao tìm kiếm các mẫu lặp lại, chu kỳ và cấu trúc ẩn trong lịch sử kết quả. Nó sử dụng các kỹ thuật từ lý thuyết thông tin và phân tích tín hiệu.';
                        break;
                }
                
                algorithmExplanation.textContent = explanation;
            }
            
            // Khởi tạo giải thích thuật toán
            updateAlgorithmExplanation();
            
            // Xử lý sự kiện thêm Tài
            addTaiBtn.addEventListener('click', function() {
                // Thêm hiệu ứng nhấn nút
                this.classList.add('button-active');
                setTimeout(() => {
                    this.classList.remove('button-active');
                }, 150);
                
                gameHistory.push('T');
                updateDisplay();
            });
            
            // Xử lý sự kiện thêm Xỉu
            addXiuBtn.addEventListener('click', function() {
                // Thêm hiệu ứng nhấn nút
                this.classList.add('button-active');
                setTimeout(() => {
                    this.classList.remove('button-active');
                }, 150);
                
                gameHistory.push('X');
                updateDisplay();
            });
            
            // Xử lý sự kiện xóa lịch sử
            clearHistoryBtn.addEventListener('click', function() {
                if (gameHistory.length === 0) {
                    alert('Không có dữ liệu để xóa!');
                    return;
                }
                
                if (confirm('Bạn có chắc chắn muốn xóa toàn bộ lịch sử?')) {
                    gameHistory = [];
                    predictionHistory = [];
                    updateDisplay();
                    updatePerformanceMetrics();
                }
            });
            
            // Xử lý sự kiện hoàn tác
            undoButton.addEventListener('click', function() {
                if (gameHistory.length === 0) {
                    alert('Không có dữ liệu để hoàn tác!');
                    return;
                }
                
                // Xóa kết quả cuối cùng
                gameHistory.pop();
                
                // Cập nhật lịch sử dự đoán nếu có
                if (predictionHistory.length > 0) {
                    predictionHistory.pop();
                }
                
                updateDisplay();
                updatePerformanceMetrics();
            });
            
            // Cập nhật toàn bộ giao diện
            function updateDisplay() {
                updateStatistics();
                updateRecentHistory();
                updateCurrentHistoryDisplay();
                
                // Tự động thực hiện dự đoán nếu có đủ dữ liệu
                if (gameHistory.length > 0) {
                    const prediction = predictNext(gameHistory, algorithmSelect.value);
                    displayPrediction(prediction);
                    updateAdvancedAnalysis();
                } else {
                    predictionResult.textContent = 'Nhập dữ liệu để xem dự đoán';
                    predictionResult.className = 'prediction';
                    taiProbability.style.width = '50%';
                    taiPercent.textContent = '50%';
                    xiuPercent.textContent = '50%';
                    confidenceFill.style.width = '0%';
                    confidenceValue.textContent = '0%';
                    confidenceLevel.textContent = 'Chưa có';
                    confidenceLevel.className = 'confidence-level low-confidence';
                }
            }
            
            function updateStatistics() {
                const total = gameHistory.length;
                const tai = gameHistory.filter(item => item === 'T').length;
                const xiu = total - tai;
                const taiRatioValue = total > 0 ? (tai / total * 100).toFixed(1) : 0;
                
                // Tính chuỗi dài nhất
                const streaks = calculateStreaks(gameHistory);
                
                // Tính xu hướng hiện tại
                const trend = calculateTrend(gameHistory);
                
                // Tính độ biến động
                const volatilityValue = calculateVolatility(gameHistory);
                
                totalGames.textContent = total;
                taiCount.textContent = tai;
                xiuCount.textContent = xiu;
                taiRatio.textContent = `${taiRatioValue}%`;
                maxTaiStreak.textContent = streaks.maxTai;
                maxXiuStreak.textContent = streaks.maxXiu;
                currentTrend.textContent = trend.direction;
                currentTrend.className = `trend-indicator ${trend.class}`;
                volatility.textContent = volatilityValue;
            }
            
            function calculateStreaks(history) {
                if (history.length === 0) return { maxTai: 0, maxXiu: 0 };
                
                let maxTai = 0, maxXiu = 0;
                let currentTai = 0, currentXiu = 0;
                
                for (let result of history) {
                    if (result === 'T') {
                        currentTai++;
                        currentXiu = 0;
                        if (currentTai > maxTai) maxTai = currentTai;
                    } else {
                        currentXiu++;
                        currentTai = 0;
                        if (currentXiu > maxXiu) maxXiu = currentXiu;
                    }
                }
                
                return { maxTai, maxXiu };
            }
            
            function calculateTrend(history) {
                if (history.length < 5) return { direction: "Không đủ dữ liệu", class: "trend-neutral" };
                
                const recent = history.slice(-10);
                const taiCount = recent.filter(r => r === 'T').length;
                const xiuCount = recent.length - taiCount;
                
                if (taiCount > xiuCount + 2) {
                    return { direction: "Tài mạnh", class: "trend-up" };
                } else if (xiuCount > taiCount + 2) {
                    return { direction: "Xỉu mạnh", class: "trend-down" };
                } else {
                    return { direction: "Cân bằng", class: "trend-neutral" };
                }
            }
            
            function calculateVolatility(history) {
                if (history.length < 5) return "Không đủ dữ liệu";
                
                let changes = 0;
                for (let i = 1; i < history.length; i++) {
                    if (history[i] !== history[i-1]) changes++;
                }
                
                const volatility = (changes / (history.length - 1) * 100).toFixed(1);
                return `${volatility}%`;
            }
            
            function updateRecentHistory() {
                historyList.innerHTML = '';
                
                if (gameHistory.length === 0) {
                    const li = document.createElement('li');
                    li.className = 'history-item';
                    li.textContent = 'Chưa có dữ liệu';
                    historyList.appendChild(li);
                    return;
                }
                
                // Hiển thị từ kết quả mới nhất đến cũ nhất
                const recentHistory = [...gameHistory].reverse();
                
                for (let i = 0; i < recentHistory.length; i++) {
                    const result = recentHistory[i];
                    const li = document.createElement('li');
                    li.className = `history-item ${result === 'T' ? 'history-tai' : 'history-xiu'}`;
                    
                    const span1 = document.createElement('span');
                    span1.textContent = `Phiên ${gameHistory.length - i}:`;
                    
                    const span2 = document.createElement('span');
                    span2.textContent = result === 'T' ? 'TÀI' : 'XỈU';
                    span2.style.fontWeight = 'bold';
                    
                    li.appendChild(span1);
                    li.appendChild(span2);
                    historyList.appendChild(li);
                }
            }
            
            function updateCurrentHistoryDisplay() {
                currentHistoryDisplay.innerHTML = '';
                
                if (gameHistory.length === 0) {
                    currentHistoryDisplay.textContent = 'Chưa có dữ liệu';
                    analysisCount.textContent = '0';
                    return;
                }
                
                // Hiển thị lịch sử dưới dạng các hình tròn
                gameHistory.forEach((result, index) => {
                    const span = document.createElement('span');
                    span.className = `history-item-display ${result === 'T' ? 'tai-display' : 'xiu-display'}`;
                    span.textContent = result;
                    span.title = `Phiên ${index + 1}: ${result === 'T' ? 'Tài' : 'Xỉu'}`;
                    
                    // Đánh dấu chuỗi gần đây
                    if (index >= gameHistory.length - 3) {
                        span.classList.add('hot-streak');
                    }
                    
                    currentHistoryDisplay.appendChild(span);
                });
                
                // Tự động tính toán độ dài phân tích
                const analysisLength = calculateAnalysisLength(gameHistory.length);
                analysisCount.textContent = analysisLength;
            }
            
            function calculateAnalysisLength(totalGames) {
                // Độ dài phân tích tự động dựa trên tổng số phiên
                if (totalGames <= 10) return totalGames;
                if (totalGames <= 20) return 10;
                if (totalGames <= 50) return 15;
                if (totalGames <= 100) return 20;
                return 25; // Tối đa phân tích 25 phiên gần nhất
            }
            
            function predictNext(history, algorithm) {
                // Tính độ dài phân tích tự động
                const analysisLength = calculateAnalysisLength(history.length);
                
                // Giới hạn lịch sử phân tích
                const analysisHistory = history.slice(-analysisLength);
                
                let taiProbability = 0.5; // Mặc định 50%
                let confidence = 0.5;
                
                switch(algorithm) {
                    case 'ensemble':
                        const ensembleResult = ensemblePrediction(analysisHistory);
                        taiProbability = ensembleResult.probability;
                        confidence = ensembleResult.confidence;
                        break;
                    case 'markov':
                        taiProbability = markovPrediction(analysisHistory);
                        confidence = calculateMarkovConfidence(analysisHistory);
                        break;
                    case 'lstm':
                        taiProbability = lstmPrediction(analysisHistory);
                        confidence = calculateLSTMConfidence(analysisHistory);
                        break;
                    case 'arima':
                        taiProbability = arimaPrediction(analysisHistory);
                        confidence = calculateArimaConfidence(analysisHistory);
                        break;
                    case 'pattern':
                        taiProbability = patternPrediction(analysisHistory);
                        confidence = calculatePatternConfidence(analysisHistory);
                        break;
                }
                
                return {
                    prediction: taiProbability >= 0.5 ? 'T' : 'X',
                    taiProbability: taiProbability,
                    xiuProbability: 1 - taiProbability,
                    confidence: confidence
                };
            }
            
            function ensemblePrediction(history) {
                if (history.length < 5) {
                    return {
                        probability: 0.5,
                        confidence: 0.1
                    };
                }
                
                // Lấy dự đoán từ tất cả các thuật toán
                const markovProb = markovPrediction(history);
                const lstmProb = lstmPrediction(history);
                const arimaProb = arimaPrediction(history);
                const patternProb = patternPrediction(history);
                
                // Tính độ tin cậy cho từng thuật toán
                const markovConf = calculateMarkovConfidence(history);
                const lstmConf = calculateLSTMConfidence(history);
                const arimaConf = calculateArimaConfidence(history);
                const patternConf = calculatePatternConfidence(history);
                
                // Cập nhật hiển thị độ tin cậy cho từng thuật toán
                updateAlgorithmConfidence('markov', markovConf, markovProb);
                updateAlgorithmConfidence('lstm', lstmConf, lstmProb);
                updateAlgorithmConfidence('arima', arimaConf, arimaProb);
                updateAlgorithmConfidence('pattern', patternConf, patternProb);
                
                // Tính tổng trọng số dựa trên độ tin cậy
                const totalWeight = markovConf + lstmConf + arimaConf + patternConf;
                
                // Tính xác suất tổng hợp
                let ensembleProbability = 0;
                if (totalWeight > 0) {
                    ensembleProbability = (
                        markovProb * markovConf +
                        lstmProb * lstmConf +
                        arimaProb * arimaConf +
                        patternProb * patternConf
                    ) / totalWeight;
                } else {
                    ensembleProbability = (markovProb + lstmProb + arimaProb + patternProb) / 4;
                }
                
                // Độ tin cậy tổng hợp là trung bình có trọng số
                const ensembleConfidence = totalWeight > 0 ? totalWeight / 4 : 0.5;
                
                return {
                    probability: ensembleProbability,
                    confidence: ensembleConfidence
                };
            }
            
            function updateAlgorithmConfidence(algorithm, confidence, probability) {
                const confidenceElement = document.getElementById(`${algorithm}Confidence`);
                const valueElement = document.getElementById(`${algorithm}Value`);
                
                if (confidenceElement && valueElement) {
                    confidenceElement.style.width = `${confidence * 100}%`;
                    valueElement.textContent = `${Math.round(confidence * 100)}%`;
                    
                    // Thêm màu sắc dựa trên xác suất
                    if (probability >= 0.6) {
                        confidenceElement.style.backgroundColor = 'var(--accent-color)';
                    } else if (probability <= 0.4) {
                        confidenceElement.style.backgroundColor = 'var(--danger-color)';
                    } else {
                        confidenceElement.style.backgroundColor = 'var(--warning-color)';
                    }
                }
            }
            
            function markovPrediction(history) {
                if (history.length < 2) return 0.5;
                
                // Markov bậc 2 - xem xét 2 trạng thái trước đó
                let transitions = {};
                
                for (let i = 2; i < history.length; i++) {
                    const state = history[i-2] + history[i-1];
                    const next = history[i];
                    
                    if (!transitions[state]) {
                        transitions[state] = { T: 0, X: 0 };
                    }
                    
                    transitions[state][next]++;
                }
                
                // Dự đoán dựa trên 2 trạng thái cuối cùng
                const lastState = history[history.length-2] + history[history.length-1];
                const transition = transitions[lastState];
                
                if (transition) {
                    const total = transition.T + transition.X;
                    return total > 0 ? transition.T / total : 0.5;
                }
                
                // Fallback: Markov bậc 1
                return markovFirstOrder(history);
            }
            
            function markovFirstOrder(history) {
                let tToT = 0, tToX = 0, xToT = 0, xToX = 0;
                
                for (let i = 0; i < history.length - 1; i++) {
                    const current = history[i];
                    const next = history[i+1];
                    
                    if (current === 'T') {
                        if (next === 'T') tToT++;
                        else tToX++;
                    } else {
                        if (next === 'T') xToT++;
                        else xToX++;
                    }
                }
                
                const lastResult = history[history.length - 1];
                let taiProbability;
                
                if (lastResult === 'T') {
                    const totalTransitions = tToT + tToX;
                    taiProbability = totalTransitions > 0 ? tToT / totalTransitions : 0.5;
                } else {
                    const totalTransitions = xToT + xToX;
                    taiProbability = totalTransitions > 0 ? xToT / totalTransitions : 0.5;
                }
                
                return taiProbability;
            }
            
            function calculateMarkovConfidence(history) {
                if (history.length < 5) return 0.1;
                
                // Độ tin cậy dựa trên số lượng chuyển đổi quan sát được
                let totalTransitions = 0;
                let uniqueTransitions = 0;
                const transitions = {};
                
                for (let i = 1; i < history.length; i++) {
                    const transition = history[i-1] + history[i];
                    if (!transitions[transition]) {
                        transitions[transition] = 0;
                        uniqueTransitions++;
                    }
                    transitions[transition]++;
                    totalTransitions++;
                }
                
                // Độ tin cậy cao nếu có nhiều chuyển đổi và phân bố đều
                const coverage = uniqueTransitions / 4; // 4 loại chuyển đổi có thể
                const confidence = Math.min(0.9, coverage * 0.7 + (totalTransitions / history.length) * 0.3);
                
                return confidence;
            }
            
            function lstmPrediction(history) {
                if (history.length < 5) return 0.5;
                
                // Mô phỏng LSTM đơn giản - tìm kiếm mẫu hình phức tạp
                // Trong thực tế, đây sẽ là một mô hình ML được đào tạo trước
                
                // Phân tích chuỗi con để tìm mẫu hình
                const sequenceLength = Math.min(5, Math.floor(history.length / 2));
                let patternScore = 0;
                let totalPatterns = 0;
                
                for (let len = 2; len <= sequenceLength; len++) {
                    const recentPattern = history.slice(-len).join('');
                    let matches = 0;
                    let totalOccurrences = 0;
                    
                    for (let i = 0; i <= history.length - len * 2; i++) {
                        const currentPattern = history.slice(i, i + len).join('');
                        if (currentPattern === recentPattern) {
                            totalOccurrences++;
                            const nextValue = history[i + len];
                            if (nextValue === 'T') matches++;
                        }
                    }
                    
                    if (totalOccurrences > 0) {
                        patternScore += (matches / totalOccurrences) * len;
                        totalPatterns += len;
                    }
                }
                
                const taiProbability = totalPatterns > 0 ? patternScore / totalPatterns : 0.5;
                
                // Áp dụng hàm kích hoạt sigmoid để làm mịn kết quả
                return 1 / (1 + Math.exp(-5 * (taiProbability - 0.5)));
            }
            
            function calculateLSTMConfidence(history) {
                if (history.length < 10) return 0.2;
                
                // Độ tin cậy dựa trên độ phức tạp của mẫu hình tìm thấy
                let patternComplexity = 0;
                const maxLen = Math.min(5, Math.floor(history.length / 2));
                
                for (let len = 2; len <= maxLen; len++) {
                    const recentPattern = history.slice(-len).join('');
                    let occurrences = 0;
                    
                    for (let i = 0; i <= history.length - len; i++) {
                        const currentPattern = history.slice(i, i + len).join('');
                        if (currentPattern === recentPattern) {
                            occurrences++;
                        }
                    }
                    
                    if (occurrences > 1) {
                        patternComplexity += len * Math.log(occurrences);
                    }
                }
                
                const maxComplexity = maxLen * Math.log(history.length / 2);
                const confidence = maxComplexity > 0 ? Math.min(0.9, patternComplexity / maxComplexity) : 0.5;
                
                return confidence;
            }
            
            function arimaPrediction(history) {
                if (history.length < 5) return 0.5;
                
                // Mô phỏng ARIMA đơn giản - phân tích xu hướng và tính tự tương quan
                const numericHistory = history.map(h => h === 'T' ? 1 : 0);
                
                // Tính trung bình động (MA)
                const maLength = Math.min(3, Math.floor(history.length / 3));
                let maSum = 0;
                for (let i = history.length - maLength; i < history.length; i++) {
                    maSum += numericHistory[i];
                }
                const movingAverage = maSum / maLength;
                
                // Tính tự hồi quy (AR)
                let arSum = 0;
                let arWeight = 0;
                for (let lag = 1; lag <= Math.min(3, history.length - 1); lag++) {
                    const weight = Math.exp(-lag / 2); // Trọng số giảm dần
                    arSum += numericHistory[history.length - 1 - lag] * weight;
                    arWeight += weight;
                }
                const autoregressive = arWeight > 0 ? arSum / arWeight : 0.5;
                
                // Kết hợp MA và AR
                const arimaPrediction = 0.6 * movingAverage + 0.4 * autoregressive;
                
                return arimaPrediction;
            }
            
            function calculateArimaConfidence(history) {
                if (history.length < 8) return 0.2;
                
                // Độ tin cậy dựa trên tính ổn định của chuỗi
                const numericHistory = history.map(h => h === 'T' ? 1 : 0);
                
                // Tính phương sai
                let sum = 0;
                for (let value of numericHistory) {
                    sum += value;
                }
                const mean = sum / numericHistory.length;
                
                let variance = 0;
                for (let value of numericHistory) {
                    variance += Math.pow(value - mean, 2);
                }
                variance /= numericHistory.length;
                
                // Chuỗi ổn định hơn (phương sai thấp) -> độ tin cậy cao hơn
                const stability = 1 - Math.min(1, variance * 4); // Phương sai tối đa là 0.25
                
                return Math.min(0.9, 0.3 + stability * 0.6);
            }
            
            function patternPrediction(history) {
                if (history.length < 3) return 0.5;
                
                // Tìm kiếm mẫu lặp lại
                const maxPatternLength = Math.min(5, Math.floor(history.length / 2));
                let bestPattern = null;
                let bestScore = 0;
                
                for (let patternLength = 1; patternLength <= maxPatternLength; patternLength++) {
                    const pattern = history.slice(-patternLength);
                    let matches = 0;
                    
                    // Tìm số lần mẫu này xuất hiện trong lịch sử
                    for (let i = 0; i <= history.length - patternLength * 2; i++) {
                        let isMatch = true;
                        for (let j = 0; j < patternLength; j++) {
                            if (history[i + j] !== pattern[j]) {
                                isMatch = false;
                                break;
                            }
                        }
                        
                        if (isMatch) {
                            matches++;
                        }
                    }
                    
                    const score = matches * patternLength;
                    if (score > bestScore) {
                        bestScore = score;
                        bestPattern = pattern;
                    }
                }
                
                // Nếu tìm thấy mẫu, dự đoán kết quả tiếp theo dựa trên mẫu
                if (bestPattern && bestScore > 1) {
                    // Tìm kết quả sau khi mẫu xuất hiện
                    let taiAfterPattern = 0;
                    let totalAfterPattern = 0;
                    
                    for (let i = 0; i <= history.length - bestPattern.length - 1; i++) {
                        let isMatch = true;
                        for (let j = 0; j < bestPattern.length; j++) {
                            if (history[i + j] !== bestPattern[j]) {
                                isMatch = false;
                                break;
                            }
                        }
                        
                        if (isMatch) {
                            const nextResult = history[i + bestPattern.length];
                            if (nextResult === 'T') taiAfterPattern++;
                            totalAfterPattern++;
                        }
                    }
                    
                    if (totalAfterPattern > 0) {
                        return taiAfterPattern / totalAfterPattern;
                    }
                }
                
                // Nếu không tìm thấy mẫu rõ ràng, sử dụng phương pháp tần suất
                return frequencyPrediction(history);
            }
            
            function calculatePatternConfidence(history) {
                if (history.length < 5) return 0.1;
                
                // Độ tin cậy dựa trên sức mạnh của mẫu tìm thấy
                const maxPatternLength = Math.min(5, Math.floor(history.length / 2));
                let totalPatternStrength = 0;
                let patternCount = 0;
                
                for (let patternLength = 1; patternLength <= maxPatternLength; patternLength++) {
                    const pattern = history.slice(-patternLength);
                    let matches = 0;
                    
                    for (let i = 0; i <= history.length - patternLength; i++) {
                        let isMatch = true;
                        for (let j = 0; j < patternLength; j++) {
                            if (history[i + j] !== pattern[j]) {
                                isMatch = false;
                                break;
                            }
                        }
                        
                        if (isMatch) {
                            matches++;
                        }
                    }
                    
                    if (matches > 1) {
                        const strength = (matches - 1) * patternLength / history.length;
                        totalPatternStrength += strength;
                        patternCount++;
                    }
                }
                
                const avgStrength = patternCount > 0 ? totalPatternStrength / patternCount : 0;
                return Math.min(0.9, avgStrength * 2);
            }
            
            function frequencyPrediction(history) {
                if (history.length === 0) return 0.5;
                
                const taiCount = history.filter(item => item === 'T').length;
                return taiCount / history.length;
            }
            
            function displayPrediction(prediction) {
                const { prediction: result, taiProbability, xiuProbability, confidence } = prediction;
                
                // Cập nhật kết quả dự đoán
                predictionResult.textContent = result === 'T' ? 'TÀI' : 'XỈU';
                predictionResult.className = `prediction ${result === 'T' ? 'tai' : 'xiu'}`;
                
                // Cập nhật thanh xác suất
                const taiPercentValue = (taiProbability * 100).toFixed(1);
                const xiuPercentValue = (xiuProbability * 100).toFixed(1);
                
                taiProbability.style.width = `${taiPercentValue}%`;
                taiPercent.textContent = `${taiPercentValue}%`;
                xiuPercent.textContent = `${xiuPercentValue}%`;
                
                // Cập nhật độ tin cậy
                const confidencePercent = Math.round(confidence * 100);
                confidenceFill.style.width = `${confidencePercent}%`;
                confidenceValue.textContent = `${confidencePercent}%`;
                
                // Cập nhật mức độ tin cậy
                if (confidence >= 0.7) {
                    confidenceLevel.textContent = 'Cao';
                    confidenceLevel.className = 'confidence-level high-confidence';
                } else if (confidence >= 0.4) {
                    confidenceLevel.textContent = 'Trung bình';
                    confidenceLevel.className = 'confidence-level medium-confidence';
                } else {
                    confidenceLevel.textContent = 'Thấp';
                    confidenceLevel.className = 'confidence-level low-confidence';
                }
            }
            
            function updateAdvancedAnalysis() {
                if (gameHistory.length < 5) {
                    patternAnalysis.textContent = 'Chưa đủ dữ liệu để phân tích mẫu hình';
                    return;
                }
                
                // Phân tích mẫu hình phức tạp
                const analysis = analyzePatterns(gameHistory);
                patternAnalysis.innerHTML = analysis;
            }
            
            function analyzePatterns(history) {
                let analysis = '';
                
                // Phân tích chuỗi liên tiếp
                const streaks = calculateCurrentStreak(history);
                analysis += `<div>Chuỗi hiện tại: <strong>${streaks.current} ${streaks.type}</strong> (${streaks.length} phiên)</div>`;
                
                // Phân tích tần suất chuyển đổi
                const changes = countChanges(history);
                analysis += `<div>Tần suất thay đổi: ${changes.rate}%</div>`;
                
                // Phân tích chu kỳ
                const cycles = detectCycles(history);
                if (cycles.detected) {
                    analysis += `<div>Chu kỳ phát hiện: ~${cycles.length} phiên</div>`;
                } else {
                    analysis += `<div>Không phát hiện chu kỳ rõ ràng</div>`;
                }
                
                // Phân tích xu hướng ngắn hạn
                const shortTerm = analyzeShortTermTrend(history);
                analysis += `<div>Xu hướng ngắn hạn: <span class="trend-indicator ${shortTerm.class}">${shortTerm.trend}</span></div>`;
                
                return analysis;
            }
            
            function calculateCurrentStreak(history) {
                if (history.length === 0) return { type: 'none', length: 0, current: '' };
                
                const lastResult = history[history.length - 1];
                let streakLength = 1;
                
                for (let i = history.length - 2; i >= 0; i--) {
                    if (history[i] === lastResult) {
                        streakLength++;
                    } else {
                        break;
                    }
                }
                
                return {
                    type: lastResult === 'T' ? 'Tài' : 'Xỉu',
                    length: streakLength,
                    current: lastResult
                };
            }
            
            function countChanges(history) {
                if (history.length < 2) return { changes: 0, rate: 0 };
                
                let changes = 0;
                for (let i = 1; i < history.length; i++) {
                    if (history[i] !== history[i-1]) changes++;
                }
                
                const rate = ((changes / (history.length - 1)) * 100).toFixed(1);
                return { changes, rate };
            }
            
            function detectCycles(history) {
                if (history.length < 10) return { detected: false, length: 0 };
                
                // Tìm kiếm chu kỳ đơn giản bằng cách so sánh các đoạn con
                const maxCycleLength = Math.min(10, Math.floor(history.length / 2));
                let bestCycleLength = 0;
                let bestMatchScore = 0;
                
                for (let cycleLen = 2; cycleLen <= maxCycleLength; cycleLen++) {
                    let matchScore = 0;
                    const cyclesToCheck = Math.floor(history.length / cycleLen) - 1;
                    
                    for (let c = 0; c < cyclesToCheck; c++) {
                        const cycle1 = history.slice(c * cycleLen, (c + 1) * cycleLen);
                        const cycle2 = history.slice((c + 1) * cycleLen, (c + 2) * cycleLen);
                        
                        for (let i = 0; i < Math.min(cycle1.length, cycle2.length); i++) {
                            if (cycle1[i] === cycle2[i]) matchScore++;
                        }
                    }
                    
                    const normalizedScore = matchScore / (cyclesToCheck * cycleLen);
                    if (normalizedScore > bestMatchScore) {
                        bestMatchScore = normalizedScore;
                        bestCycleLength = cycleLen;
                    }
                }
                
                return {
                    detected: bestMatchScore > 0.6,
                    length: bestCycleLength,
                    score: bestMatchScore
                };
            }
            
            function analyzeShortTermTrend(history) {
                if (history.length < 5) return { trend: 'Không đủ dữ liệu', class: 'trend-neutral' };
                
                const shortTerm = history.slice(-5);
                const taiCount = shortTerm.filter(r => r === 'T').length;
                const xiuCount = 5 - taiCount;
                
                if (taiCount >= 4) {
                    return { trend: 'Tài mạnh', class: 'trend-up' };
                } else if (xiuCount >= 4) {
                    return { trend: 'Xỉu mạnh', class: 'trend-down' };
                } else if (taiCount === 3) {
                    return { trend: 'Hơi nghiêng Tài', class: 'trend-up' };
                } else if (xiuCount === 3) {
                    return { trend: 'Hơi nghiêng Xỉu', class: 'trend-down' };
                } else {
                    return { trend: 'Cân bằng', class: 'trend-neutral' };
                }
            }
            
            function updatePerformanceMetrics() {
                if (predictionHistory.length < 2) {
                    overallAccuracy.textContent = '-';
                    recentAccuracy.textContent = '-';
                    taiAccuracy.textContent = '-';
                    xiuAccuracy.textContent = '-';
                    return;
                }
                
                // Tính độ chính xác tổng thể
                let correctPredictions = 0;
                for (let i = 1; i < predictionHistory.length; i++) {
                    if (predictionHistory[i].prediction === gameHistory[i]) {
                        correctPredictions++;
                    }
                }
                const overallAcc = (correctPredictions / (predictionHistory.length - 1) * 100).toFixed(1);
                overallAccuracy.textContent = `${overallAcc}%`;
                
                // Tính độ chính xác gần đây (10 phiên cuối)
                let recentCorrect = 0;
                const recentCount = Math.min(10, predictionHistory.length - 1);
                for (let i = predictionHistory.length - recentCount; i < predictionHistory.length; i++) {
                    if (predictionHistory[i] && predictionHistory[i].prediction === gameHistory[i]) {
                        recentCorrect++;
                    }
                }
                const recentAcc = recentCount > 0 ? (recentCorrect / recentCount * 100).toFixed(1) : 0;
                recentAccuracy.textContent = `${recentAcc}%`;
                
                // Tính độ chính xác khi dự đoán Tài
                let taiPredictions = 0;
                let taiCorrect = 0;
                for (let i = 1; i < predictionHistory.length; i++) {
                    if (predictionHistory[i].prediction === 'T') {
                        taiPredictions++;
                        if (gameHistory[i] === 'T') {
                            taiCorrect++;
                        }
                    }
                }
                const taiAcc = taiPredictions > 0 ? (taiCorrect / taiPredictions * 100).toFixed(1) : 0;
                taiAccuracy.textContent = `${taiAcc}%`;
                
                // Tính độ chính xác khi dự đoán Xỉu
                let xiuPredictions = 0;
                let xiuCorrect = 0;
                for (let i = 1; i < predictionHistory.length; i++) {
                    if (predictionHistory[i].prediction === 'X') {
                        xiuPredictions++;
                        if (gameHistory[i] === 'X') {
                            xiuCorrect++;
                        }
                    }
                }
                const xiuAcc = xiuPredictions > 0 ? (xiuCorrect / xiuPredictions * 100).toFixed(1) : 0;
                xiuAccuracy.textContent = `${xiuAcc}%`;
                
                // Cập nhật màu sắc dựa trên độ chính xác
                updateAccuracyColor(overallAccuracy, overallAcc);
                updateAccuracyColor(recentAccuracy, recentAcc);
                updateAccuracyColor(taiAccuracy, taiAcc);
                updateAccuracyColor(xiuAccuracy, xiuAcc);
            }
            
            function updateAccuracyColor(element, accuracy) {
                const accValue = parseFloat(accuracy);
                if (accValue >= 60) {
                    element.className = 'metric-value accuracy-high';
                } else if (accValue >= 40) {
                    element.className = 'metric-value accuracy-medium';
                } else {
                    element.className = 'metric-value accuracy-low';
                }
            }
            
            // Khởi tạo giao diện
            updateDisplay();
        });
    </script>
</body>
</html>
